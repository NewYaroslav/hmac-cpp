# hmac-cpp

[![Linux](https://github.com/NewYaroslav/hmac-cpp/actions/workflows/CI-Linux.yml/badge.svg?branch=main)](https://github.com/NewYaroslav/hmac-cpp/actions/workflows/CI-Linux.yml)
[![Windows](https://github.com/NewYaroslav/hmac-cpp/actions/workflows/CI-Win.yml/badge.svg?branch=main)](https://github.com/NewYaroslav/hmac-cpp/actions/workflows/CI-Win.yml)
[![macOS](https://github.com/NewYaroslav/hmac-cpp/actions/workflows/CI-macOS.yml/badge.svg?branch=main)](https://github.com/NewYaroslav/hmac-cpp/actions/workflows/CI-macOS.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

–õ—ë–≥–∫–∞—è `C++11` –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è `HMAC` (hash-based message authentication code), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è `SHA256`, `SHA512`, `SHA1`, –∞ —Ç–∞–∫–∂–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ `HOTP` –∏ `TOTP`.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å **C++11**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `HMAC` –Ω–∞ –æ—Å–Ω–æ–≤–µ `SHA256`, `SHA512`, `SHA1`
- –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∏–Ω–∞—Ä–Ω—ã–º –∏–ª–∏ hex-—Ñ–æ—Ä–º–∞—Ç–æ–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **PBKDF2** (RFC 8018)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **HKDF** (RFC 5869) –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–ª—é—á–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤**:
    - **HOTP (RFC 4226)** ‚Äî —Å—á—ë—Ç—á–∏–∫–∏
    - **TOTP (RFC 6238)** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
    - **HMAC Time Tokens** ‚Äî –æ–±–ª–µ–≥—á—ë–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å HMAC-–ø–æ–¥–ø–∏—Å—å—é –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **MQL5** ‚Äî –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ SHA/HMAC –¥–ª—è MetaTrader 
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ —á–µ—Ä–µ–∑ CMake
- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ—Ä—ã, —Ç–µ—Å—Ç—ã –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏ –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è. –í–∫–ª—é—á–∏—Ç–µ –∏—Ö —Å –ø–æ–º–æ—â—å—é
`HMACCPP_BUILD_EXAMPLES`, `HMACCPP_BUILD_TESTS` –∏ `HMACCPP_BUILD_BENCH`.

–î–ª—è —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CMake:

```bash
cmake -B build -DHMACCPP_BUILD_EXAMPLES=ON
cmake --build build
```

–ß—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏:

```bash
cmake --install build --prefix _install
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```
_install/
‚îú‚îÄ‚îÄ include/hmac_cpp/
‚îÇ   ‚îú‚îÄ‚îÄ hmac.hpp
‚îÇ   ‚îú‚îÄ‚îÄ hmac_utils.hpp
‚îÇ   ‚îú‚îÄ‚îÄ sha1.hpp
‚îÇ   ‚îú‚îÄ‚îÄ sha256.hpp
‚îÇ   ‚îî‚îÄ‚îÄ sha512.hpp
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ libhmac.a
```

–ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞–∫ `<hmac_cpp/...>`

–¢–∞–∫–∂–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ `.bat`-—Ñ–∞–π–ª—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø–æ–¥ MinGW: `build_*.bat`.

## üì¶ MQL5-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í —Ä–µ–ø–æ–∑–∏—Ç–∏–æ—Ä–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è —Ñ–∞–π–ª—ã `sha256.mqh`, `sha512.mqh`, `hmac.mqh`, `hmac_utils.mqh`, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å `MetaTrader 5`.

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö –∏ —Å–æ–≤–µ—Ç–Ω–∏–∫–∞—Ö:

```mql5
#include <hmac-cpp/hmac.mqh>

string hash = hmac::get_hmac("key", "message", hmac::TypeHash::SHA256);
```

| –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ –≤ C++           | –ó–Ω–∞—á–µ–Ω–∏–µ –≤ MQL           |
|-------------|--------------------------|--------------------------|
| SHA1        | `hmac::TypeHash::SHA1`   | ‚Äì (–Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ)          |
| SHA256      | `hmac::TypeHash::SHA256` | `hmac::TypeHash::SHA256` |
| SHA512      | `hmac::TypeHash::SHA512` | `hmac::TypeHash::SHA512` |

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### HMAC (–≤–≤–æ–¥ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏)

```cpp
std::string get_hmac(
    const std::string& key,
    const std::string& msg,
    TypeHash type,
    bool is_hex = true,
    bool is_upper = false);
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `key` ‚Äî –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
- `msg` ‚Äî –°–æ–æ–±—â–µ–Ω–∏–µ
- `type` ‚Äî –¢–∏–ø —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏: `hmac::TypeHash::SHA256` –∏–ª–∏ `SHA512`
- `is_hex` ‚Äî –í–æ–∑–≤—Ä–∞—â–∞—Ç—å hex-—Å—Ç—Ä–æ–∫—É (`true`) –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`false`) [–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true]
- `is_upper` ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä (—Ç–æ–ª—å–∫–æ –¥–ª—è `hex`) [–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false]

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
–ï—Å–ª–∏ `is_hex == true`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HMAC –≤ –≤–∏–¥–µ hex-—Å—Ç—Ä–æ–∫–∏ (`std::string`).
–ï—Å–ª–∏ `is_hex == false`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—É—é —Å—Ç—Ä–æ–∫—É; –¥–ª—è –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–æ `std::vector<uint8_t>`.

#### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏

–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ø–æ–ª—É—á–µ–Ω –≤ –≤–∏–¥–µ `std::string` (–Ω–∞–ø—Ä–∏–º–µ—Ä, API‚Äë–∫–ª—é—á –±–∏—Ä–∂–∏),
–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ `secure_buffer`, —á—Ç–æ–±—ã –∏—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å—Ä–∞–∑—É –æ—á–∏—Å—Ç–∏–ª–∞—Å—å:

```cpp
#include <cstdlib>
#include <hmac_cpp/secure_buffer.hpp>

std::string api_key = std::getenv("API_KEY");
secure_buffer key(std::move(api_key)); // api_key –æ—á–∏—â–µ–Ω–∞

auto sig = hmac::get_hmac(key, payload, hmac::TypeHash::SHA256);
secure_zero(key); // –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏: –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

–ß—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞–ø—Ä—è–º—É—é, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ
`hmac::constant_time_equal` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏:

```cpp
bool same = hmac::constant_time_equal(expected_token, user_token); // –¥–ª–∏–Ω—ã –ø—É–±–ª–∏—á–Ω—ã
```

### HMAC (—Å—ã—Ä—ã–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

```cpp
std::vector<uint8_t> get_hmac(
    const void* key_ptr,
    size_t key_len,
    const void* msg_ptr,
    size_t msg_len,
    TypeHash type
);
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `key_ptr` ‚Äî –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±—É—Ñ–µ—Ä —Å –∫–ª—é—á–æ–º
- `key_len` ‚Äî –†–∞–∑–º–µ—Ä –∫–ª—é—á–∞ –≤ –±–∞–π—Ç–∞—Ö
- `msg_ptr` ‚Äî –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±—É—Ñ–µ—Ä —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- `msg_len` ‚Äî –†–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–∞–π—Ç–∞—Ö
- `type` ‚Äî –¢–∏–ø —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ë–∏–Ω–∞—Ä–Ω—ã–π HMAC –≤ –≤–∏–¥–µ `std::vector<uint8_t>`

### HMAC (–≤–µ–∫—Ç–æ—Ä—ã)

```cpp
template<typename T>
std::vector<uint8_t> get_hmac(
    const std::vector<T>& key,
    const std::vector<T>& msg,
    TypeHash type
);
```

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞: `T` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `char` –∏–ª–∏ `uint8_t`

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `key` ‚Äî –í–µ–∫—Ç–æ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–ª—é—á
- `msg` ‚Äî –í–µ–∫—Ç–æ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–æ–æ–±—â–µ–Ω–∏–µ
- `type` ‚Äî –¢–∏–ø —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ë–∏–Ω–∞—Ä–Ω—ã–π HMAC –≤ –≤–∏–¥–µ `std::vector<uint8_t>`

### PBKDF2

PBKDF2 –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–ª—é—á.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö–µ—à–µ–π –ø–∞—Ä–æ–ª–µ–π.

```cpp
#include <hmac_cpp/hmac_utils.hpp>
auto salt = hmac::random_bytes(16);
auto key  = hmac::pbkdf2_hmac_sha256(password, salt, iters, 32);
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- **–°–æ–ª—å:** —Å–ª—É—á–∞–π–Ω—ã–µ 16‚Äì32 –±–∞–π—Ç–∞.
- **–ò—Ç–µ—Ä–∞—Ü–∏–∏:** –ø–æ–¥–±–∏—Ä–∞–π—Ç–µ —á–∏—Å–ª–æ —Ç–∞–∫, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–ª–æ ~100‚Äì250‚ÄØ–º—Å –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ.
- **–î–ª–∏–Ω–∞ –∫–ª—é—á–∞:** 32 –±–∞–π—Ç–∞.
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** HMAC-SHA-256.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç –º–æ–∂–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫:
`magic|salt|iters|iv|ct|tag`.

–°–º. `example_pbkdf2.cpp` –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞.

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –¶–µ–ª—å   | –ò—Ç–µ—Ä–∞—Ü–∏–∏ | –î–ª–∏–Ω–∞ –∫–ª—é—á–∞ | PRF         |
|--------|---------:|------------:|-------------|
| Desktop| 600000   | 32 –±–∞–π—Ç–∞    | HMAC-SHA256 |
| Laptop | 300000   | 32 –±–∞–π—Ç–∞    | HMAC-SHA256 |
| Mobile | 150000   | 32 –±–∞–π—Ç–∞    | HMAC-SHA256 |

#### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- PBKDF2 –∑–∞–≤–∏—Å–∏—Ç –æ—Ç CPU –∏ —É—è–∑–≤–∏–º –¥–ª—è –∞—Ç–∞–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GPU/ASIC, –ø–æ—ç—Ç–æ–º—É –≤—ã–±–∏—Ä–∞–π—Ç–µ –≤—ã—Å–æ–∫–æ–µ —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –∏–ª–∏ –±–æ–ª–µ–µ —Å–∏–ª—å–Ω—ã–µ KDF.
- –ö–∞–∂–¥–æ–º—É –ø–∞—Ä–æ–ª—é –Ω—É–∂–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–ª—É—á–∞–π–Ω–∞—è —Å–æ–ª—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –¥–ª–∏–Ω—ã.
- –°–æ–ª—å, –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º ‚Äî —Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö –≤–º–µ—Å—Ç–µ —Å —Ö–µ—à–µ–º –∏–ª–∏ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–æ–º.

### üïì HOTP –∏ TOTP —Ç–æ–∫–µ–Ω—ã

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –ø–∞—Ä–æ–ª–µ–π –ø–æ RFC 4226 –∏ RFC 6238.
–°–µ–∫—Ä–µ—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –≤–∏–¥–µ —Å—ã—Ä—ã—Ö –±–∞–π—Ç. –ï—Å–ª–∏ –æ–Ω –∑–∞–¥–∞–Ω –≤ Base32 (—á–∞—Å—Ç–æ –≤ OTP URI),
—Å–Ω–∞—á–∞–ª–∞ –¥–µ–∫–æ–¥–∏—Ä—É–π—Ç–µ –µ–≥–æ.

- **HOTP** ‚Äî 6 —Ü–∏—Ñ—Ä, SHA-1.
- **TOTP** ‚Äî –ø–µ—Ä–∏–æ–¥ 30‚ÄØ—Å, 6 —Ü–∏—Ñ—Ä, SHA-1. `is_totp_token_valid` –¥–æ–ø—É—Å–∫–∞–µ—Ç –æ–∫–Ω–æ ¬±1 –∏–Ω—Ç–µ—Ä–≤–∞–ª.

#### HOTP (HMAC-based One-Time Password)

```cpp
#include <hmac_cpp/hmac_utils.hpp>

std::string key = "12345678901234567890"; // raw key
uint64_t counter = 0;
int otp = get_hotp_code(key, counter); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 6 —Ü–∏—Ñ—Ä, SHA1
std::cout << "HOTP: " << otp << std::endl;
bool ok = (otp == 755224); // —Ç–µ—Å—Ç–æ–≤—ã–π –≤–µ–∫—Ç–æ—Ä RFC 4226
```

#### TOTP (Time-based One-Time Password)

```
#include <hmac_cpp/hmac_utils.hpp>

std::string key = "12345678901234567890"; // raw key
int otp = get_totp_code(key); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30 —Å–µ–∫, 6 —Ü–∏—Ñ—Ä, SHA1
std::cout << "TOTP: " << otp << std::endl;
```

–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏:

```cpp
uint64_t time_at = 1700000000;
int otp = get_totp_code_at(key, time_at);
```

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞:

```cpp
bool valid = hmac::is_totp_token_valid(94287082, key, 59, 30, 8, hmac::TypeHash::SHA1); // —Ç–µ—Å—Ç–æ–≤—ã–π –≤–µ–∫—Ç–æ—Ä RFC 6238
```

–ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã: [RFC¬†4226, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬†D](https://www.rfc-editor.org/rfc/rfc4226#appendix-D) –∏ [RFC¬†6238, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬†B](https://www.rfc-editor.org/rfc/rfc6238#appendix-B).

### üïì –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HMAC (Custom HMAC Time Tokens)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞–µ—Ç **–æ–±–ª–µ–≥—á—ë–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö HMAC-—Ç–æ–∫–µ–Ω–æ–≤**. –≠—Ç–æ **–Ω–µ** TOTP/HOTP; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –º–µ—Ö–∞–Ω–∏–∑–º `HMAC(timestamp)`. –≠—Ç–∏ —Ç–æ–∫–µ–Ω—ã:

- –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ `HMAC(timestamp)` ‚Äî –Ω–µ TOTP/HOTP
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `SHA256` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–∞–∫–∂–µ `SHA1` –∏ `SHA512`)
- –¢–µ–≥ ‚Äî –ø–æ–ª–Ω—ã–π HMAC: 32 –±–∞–π—Ç–∞ (64 hex-—Å–∏–º–≤–æ–ª–∞) –ø—Ä–∏ `SHA256`
- –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ: `hex` –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
- –¢–æ–∫–µ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ, —Ç–µ–∫—É—â–µ–≥–æ –∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (¬±`interval_sec`)
- –ù–µ —Ç—Ä–µ–±—É—é—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å—Å—è –∫ *–æ—Ç–ø–µ—á–∞—Ç–∫—É –∫–ª–∏–µ–Ω—Ç–∞* (–Ω–∞–ø—Ä–∏–º–µ—Ä, ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- –û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±–∞–∑–æ–≤—É—é –∑–∞—â–∏—Ç—É –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏ –ø–æ–¥—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–¥–∞—á —Å –Ω–∏–∑–∫–∏–º —Ä–∏—Å–∫–æ–º

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```cpp
#include <hmac_cpp/hmac_utils.hpp>

std::string token = hmac::generate_time_token(secret_key, 60);
bool is_valid = hmac::is_token_valid(token, secret_key, 60);
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ç–æ–∫–µ–Ω –∫ *–æ—Ç–ø–µ—á–∞—Ç–∫—É –∫–ª–∏–µ–Ω—Ç–∞* (fingerprint):

```cpp
std::string token = hmac::generate_time_token(secret_key, fingerprint, 60);
bool is_valid = hmac::is_token_valid(token, secret_key, fingerprint, 60);
```

–ï—Å–ª–∏ `interval_sec` –Ω–µ–ø–æ–ª–æ–∂–∏—Ç–µ–ª–µ–Ω, —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–±—Ä–æ—Å—è—Ç `std::invalid_argument`:

```cpp
try {
    hmac::generate_time_token(secret_key, 0);
} catch (const std::invalid_argument& e) {
    std::cout << e.what();
}
```

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –∑–∞—â–∏—Ç—ã API –∏ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤.

## üìÑ –ü—Ä–∏–º–µ—Ä

–ü—Ä–∏–º–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `example.cpp` –∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ `HMACCPP_BUILD_EXAMPLES=ON`.

```cpp
#include <iostream>
#include <hmac_cpp/hmac.hpp>
#include <hmac_cpp/hmac_utils.hpp>

int main() {
    std::string input = "grape";
    std::string key = "12345";

    std::string mac = hmac::get_hmac(key, input, hmac::TypeHash::SHA256);
    if (hmac::constant_time_equal(mac,
            "7632ac2e8ddedaf4b3e7ab195fefd17571c37c970e02e169195a158ef59e53ca")) {
        std::cout << "MAC –ø—Ä–æ–≤–µ—Ä–µ–Ω\n";
    }

    return 0;
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `constant_time_equal` —Å—á–∏—Ç–∞–µ—Ç –¥–ª–∏–Ω—É –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏—á–Ω–æ–π –∏
–≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã. –ù–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–ª–∏–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî
—Ä–∞–Ω–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–≥—É—Ç –≤—ã–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –ø–æ–±–æ—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏
–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –≤—Ä—É—á–Ω—É—é –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
g++ example.cpp -std=c++11 -Iinclude -Llib -lhmac_cpp
```

–î–ª—è MSVC:

```bat
cl /EHsc example.cpp /I include /link libhmac_cpp.lib
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

* –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ [SHA256](http://www.zedwood.com/article/cpp-sha256-function)
* –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ [SHA512](http://www.zedwood.com/article/cpp-sha512-function)
* –û–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ [HMAC](https://ru.wikipedia.org/wiki/HMAC)

## üîó –î—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã

- [ADVobfuscator](https://github.com/andrivet/ADVobfuscator)
- [obfy](https://github.com/NewYaroslav/obfy)
- [aescpp](https://github.com/NewYaroslav/aescpp)
- [siphash-hpp](https://github.com/NewYaroslav/siphash-hpp)

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **MIT**.  
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∫–æ–¥, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ª–∏—Ü–µ–Ω–∑–∏–∏.

–°–º. —Ñ–∞–π–ª [`LICENSE`](./LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
